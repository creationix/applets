async function i(e){const r=document.createElement("img");return r.setAttribute("src",e),await new Promise((e,t)=>{r.onload=e,r.onerror=t}),r}function l(t,e,r){var o=t.createShader(t.VERTEX_SHADER);if(!o)throw new Error("Problem creating new vertex shader");var n=t.createShader(t.FRAGMENT_SHADER);if(!n)throw new Error("Problem creating new fragment shader");t.shaderSource(o,e),t.shaderSource(n,r),t.compileShader(o),t.compileShader(n);var i=t.createProgram();if(!i)throw new Error("Problem creating new shader program");if(t.attachShader(i,o),t.attachShader(i,n),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS)){const v=[t.getProgramInfoLog(i)];o=t.getShaderInfoLog(o);o&&v.push(o);n=t.getShaderInfoLog(n);throw n&&v.push(n),new Error(v.join("\n"))}var a=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);const c={};for(let e=0;e<a;e++){var l=t.getActiveUniform(i,e);if(!l)throw new Error("Problem reflecting uniform");var{name:f,size:u,type:s}=l,l=t.getUniformLocation(i,f);c[f]={location:l,size:u,type:s}}const m={};var E=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES);for(let e=0;e<E;e++){var d=t.getActiveAttrib(i,e);if(!d)throw new Error("Problem reflecting attribute");var{name:h,size:g,type:A}=d,d=t.getAttribLocation(i,h);m[h]={location:d,size:g,type:A}}return{program:i,uniforms:c,attributes:m}}const E={35665:3,35666:4};function f(e,t,r){let o,n=null;var i=!!r.indices;function a(e){if(void 0===o)o=e;else if(o!==e)throw new Error("Element number mismatch")}for(const s in r){var c=r[s],l="indices"===s,f=l?e.ELEMENT_ARRAY_BUFFER:e.ARRAY_BUFFER,u=e.createBuffer();if(!u)throw new Error("Problem creating buffer");if(e.bindBuffer(f,u),e.bufferData(f,c,e.STATIC_DRAW),e.bindBuffer(f,null),l)n=u,a(c.length);else{const m=t[s];if(m.buffer=u,!i){u=E[m.type];if(!u)throw new Error(`No known size for type 0x${m.type.toString(16)}`);a(c.length/u)}}}return{numElements:o,indices:n,attribs:t}}const u={35665:function(e,t,r,o){e.bindBuffer(e.ARRAY_BUFFER,o),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,3,e.FLOAT,!1,0,0)},35666:function(e,t,r,o){e.bindBuffer(e.ARRAY_BUFFER,o),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,4,e.FLOAT,!1,0,0)}};function s(e,t){var{attribs:r,indices:t}=t;for(const n in r){var o=r[n];if(!o)throw new Error(`Unknown attribute '${n}'`);const{location:i,size:a,type:c,buffer:l}=o,f=u[c];if(!f)throw new Error(`Unsupported type 0x${c.toString(16)}`);f(e,i,a,l)}t&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t)}const m={35676:function(e,t,r,o){e.uniformMatrix4fv(t,!1,o)},35665:function(e,t,r,o){e.uniform3fv(t,o)},35680:function(e,t,r,o){e.uniform1i(t,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,o),e.bindSampler(0,null)},36289:function(e,t,r,o){e.uniform1i(t,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D_ARRAY,o),e.bindSampler(0,null)}};function d(e,t,r){for(const i in r){var o=t[i];if(!o)throw new Error(`Unknown uniform '${i}'`);var n=r[i];const{location:a,size:c,type:l}=o,f=m[l];if(!f)throw new Error(`Unsupported type 0x${l.toString(16)}`);f(e,a,c,n)}}const a=`#version 300 es
  precision highp float;

  in vec3 position;
  uniform mat4 viewProjection;

  out vec3 texCoord;

  void main() {
      gl_Position = viewProjection * vec4(position, 1);
      texCoord = position;
  }
`,c=`#version 300 es
  precision highp float;

  in vec3 texCoord;
  out vec4 fragColor;
  uniform samplerCube cubemap;

  void main (void) {
    fragColor = texture(cubemap, texCoord);
  }
`;async function t(t,e){e=i(e);const r=l(t,a,c),o=f(t,r.attributes,{position:new Float32Array([500,500,500,500,500,-500,500,-500,500,500,-500,-500,-500,500,500,-500,500,-500,-500,-500,500,-500,-500,-500]),indices:new Uint8Array([0,3,2,3,0,1,4,7,5,7,4,6,0,5,1,5,0,4,2,7,6,7,2,3,0,6,4,6,0,2,1,7,3,7,1,5])}),n=function(e,t){var r=t.width/2,o=t.height/3;const n=document.createElement("canvas");n.width=r,n.height=o;const i=n.getContext("2d");var a=e.createTexture();if(!a)throw new Error("Problem creating cubemap texture");return e.bindTexture(e.TEXTURE_CUBE_MAP,a),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_CUBE_MAP,a),i.drawImage(t,0,0,r,o,0,0,r,o),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),i.drawImage(t,r,0,r,o,0,0,r,o),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_X,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),i.drawImage(t,0,o,r,o,0,0,r,o),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_Y,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),i.drawImage(t,r,o,r,o,0,0,r,o),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),i.drawImage(t,0,2*o,r,o,0,0,r,o),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_Z,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),i.drawImage(t,r,2*o,r,o,0,0,r,o),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.generateMipmap(e.TEXTURE_CUBE_MAP),e.bindTexture(e.TEXTURE_CUBE_MAP,null),a}(t,await e);return function(e){t.useProgram(r.program),d(t,r.uniforms,{viewProjection:e,cubemap:n}),s(t,o),t.drawElements(t.TRIANGLES,o.numElements,t.UNSIGNED_BYTE,0)}}let n="undefined"!=typeof Float32Array?Float32Array:Array;function r(){let e=new n(3);return n!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function A(e){var t=e[0],r=e[1],e=e[2];return Math.hypot(t,r,e)}function e(e,t,r){let o=new n(3);return o[0]=e,o[1]=t,o[2]=r,o}function v(e,t,r,o){return e[0]=t,e[1]=r,e[2]=o,e}function T(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function p(e,t,r,o){return e[0]=t[0]+r[0]*o,e[1]=t[1]+r[1]*o,e[2]=t[2]+r[2]*o,e}function o(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function w(e,t,r,o){let n=[],i=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],i[0]=n[2]*Math.sin(o)+n[0]*Math.cos(o),i[1]=n[1],i[2]=n[2]*Math.cos(o)-n[0]*Math.sin(o),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});r();var h,g=10,R=13,_=16,y=18,P=26;const b={barrel:[1,1,0,2,1,1],barrelOpen:[1,1,3,2,1,1],bookshelf:[4,4,5,5,4,4],cobblestone:[P,P,P,P,P,P],craftingTable:[29,29,27,5,28,29],dirt:[R,R,R,R,R,R],furnace:[y,y,17,17,y,19],furnaceOn:[y,y,17,17,y,20],glass:[_,_,_,_,_,_],grass:[12,12,11,R,12,12],hay:[15,15,14,14,15,15],loom:[25,25,23,5,24,25],musicBox:[22,22,21,21,22,22],oakLog:[6,6,7,7,6,6],oakPlanks:[5,5,5,5,5,5],pumpkin:[31,31,30,30,31,31],stone:[g,g,g,g,g,g],strippedOak:[8,8,9,9,8,8]},U={glass:1},x=Object.keys(b);function M(e){var t=1&e?-1:1;return 4&e?[0,0,t]:2&e?[0,t,0]:[t,0,0]}x.forEach((e,t)=>{b[e].index=t});const B=new Uint16Array(4096);function D(o,e,n,i,t,a,c,r,l=24){var f=r.index+1;for(let r=e;r<e+t;r++)for(let t=n;t<n+a;t++)for(let e=i;e<i+c;e++)o[r+16*t+256*e]=f<<5|l}if(D(B,0,0,0,16,1,16,b.stone),D(B,0,1,0,16,1,16,b.dirt),D(B,0,2,0,5,1,16,b.grass),D(B,14,2,0,2,1,16,b.grass),D(B,5,2,0,9,1,4,b.grass),D(B,5,2,11,9,1,5,b.grass),D(B,5,2,4,9,1,7,b.cobblestone),D(B,5,3,4,1,5,1,b.oakLog),D(B,5,3,10,1,5,1,b.oakLog),D(B,13,3,4,1,5,1,b.oakLog),D(B,13,3,10,1,5,1,b.oakLog),D(B,5,3,5,1,2,5,b.strippedOak),D(B,5,6,5,1,2,5,b.strippedOak),D(B,5,8,6,1,1,3,b.strippedOak),D(B,5,9,7,1,1,1,b.strippedOak),D(B,5,5,5,1,1,5,b.glass),D(B,6,3,4,1,5,1,b.oakPlanks),D(B,12,3,4,1,5,1,b.oakPlanks),D(B,7,3,4,5,1,1,b.oakPlanks),D(B,7,6,4,5,2,1,b.oakPlanks),D(B,7,4,4,5,2,1,b.glass),D(B,6,3,10,1,5,1,b.oakPlanks),D(B,12,3,10,1,5,1,b.oakPlanks),D(B,7,3,10,5,1,1,b.oakPlanks),D(B,7,6,10,5,2,1,b.oakPlanks),D(B,7,4,10,5,2,1,b.glass),D(B,7,6,10,5,2,1,b.oakPlanks),D(B,1,3,2,1,1,1,b.pumpkin),D(B,2,3,4,1,1,1,b.pumpkin),D(B,3,3,3,1,1,1,b.pumpkin),D(B,2,3,2,1,1,1,b.pumpkin),D(B,4,3,1,1,1,1,b.pumpkin),D(B,6,3,5,2,2,3,b.hay),D(B,8,3,5,1,1,1,b.barrel),D(B,6,3,8,1,1,1,b.barrelOpen),D(B,6,3,9,2,3,1,b.bookshelf),D(B,9,3,9,1,1,1,b.furnace),D(B,10,3,9,1,1,1,b.furnaceOn),D(B,11,3,9,1,1,1,b.musicBox),D(B,11,3,5,1,1,1,b.loom),D(B,12,3,5,1,1,1,b.craftingTable),import.meta.main)for(let e=0;e<32;e++){var[k,I]=(h=h=e,[(h+=2)/6|0,h%6].map(M));o(k,I)||console.log(e,k,I)}const X=(e,t)=>e<<15,Y=(e,t)=>e<<15|t<<10,S=0,C=1<<20,F=2<<20,L=3<<20,G=4<<20,N=5<<20;function j(g){const A=[],v=new Uint8Array(256);for(let e=0;e<16;e++)t(e,0,4,8,1,0);for(let e=0;e<16;e++)t(e,0,4,8,-1,1);for(let e=0;e<16;e++)t(e,4,8,0,1,2);for(let e=0;e<16;e++)t(e,4,8,0,-1,3);for(let e=0;e<16;e++)t(e,8,0,4,1,4);for(let e=0;e<16;e++)t(e,8,0,4,-1,5);function t(i,r,o,n,a,c){for(let t=0;t<16;t++)for(let e=0;e<16;e++){var l=e|t<<4,f=g[i<<r|e<<o|t<<n];if(f){var u=i+a,s=u<0||16<=u?0:g[u<<r|e<<o|t<<n],u=x[(f>>5)-1];if(s){f=U[u]||0,s=x[(s>>5)-1];if((U[s]||0)<=f){v[l]=0;continue}}v[l]=b[u][c]+1}else v[l]=0}for(let t=0;t<16;t++)for(let e=0;e<16;e++){var m=e|t<<4;let n=v[m];if(n){let r=0;for(;e+r<16;){var E=m+r;if(v[E]!==n)break;r++}let o=0;for(;t+o<16;){let t=!0;for(let e=0;e<r;e++){var d=m+e+(o<<4);if(v[d]!==n){t=!1;break}}if(!t)break;for(let e=0;e<r;e++){var h=m+e+(o<<4);v[h]=0}o++}n--,0===c?A.push(i+1,e+0,t+0,S|Y(o,r)|n,i+1,e+r,t+0,S|X(o)|n,i+1,e+0,t+o,S|(o,r<<10)|n,i+1,e+0,t+o,S|(o,r<<10)|n,i+1,e+r,t+0,S|X(o)|n,i+1,e+r,t+o,0|S|n):1===c?A.push(i+0,e+0,t+0,C|(o,r<<10)|n,i+0,e+0,t+o,C|Y(o,r)|n,i+0,e+r,t+0,0|C|n,i+0,e+r,t+0,0|C|n,i+0,e+0,t+o,C|Y(o,r)|n,i+0,e+r,t+o,C|X(o)|n):2===c?A.push(t+0,i+1,e+0,0|F|n,t+0,i+1,e+r,F|(o,r<<10)|n,t+o,i+1,e+0,F|X(o)|n,t+o,i+1,e+0,F|X(o)|n,t+0,i+1,e+r,F|(o,r<<10)|n,t+o,i+1,e+r,F|Y(o,r)|n):3===c?A.push(t+0,i+0,e+0,L|X(o)|n,t+o,i+0,e+0,0|L|n,t+0,i+0,e+r,L|Y(o,r)|n,t+0,i+0,e+r,L|Y(o,r)|n,t+o,i+0,e+0,0|L|n,t+o,i+0,e+r,L|(o,r<<10)|n):4===c?A.push(e+0,t+0,i+1,G|(r,o<<10)|n,e+r,t+0,i+1,G|Y(r,o)|n,e+0,t+o,i+1,0|G|n,e+0,t+o,i+1,0|G|n,e+r,t+0,i+1,G|Y(r,o)|n,e+r,t+o,i+1,G|X(r)|n):5===c&&A.push(e+0,t+0,i+0,N|Y(r,o)|n,e+0,t+o,i+0,N|X(r)|n,e+r,t+0,i+0,N|(r,o<<10)|n,e+r,t+0,i+0,N|(r,o<<10)|n,e+0,t+o,i+0,N|X(r)|n,e+r,t+o,i+0,0|N|n)}}}return new Float32Array(A)}const O=`#version 300 es
  precision highp float;

  uniform mat4 viewProjection;

  in vec4 data;

  out vec3 uv;
  out vec3 normal;
  out vec3 position;

  void main(void) {
    gl_Position = viewProjection * vec4(data.xyz, 1.0);

    int meta = int(data.w);
    int ni = meta >> 20;
    int ns = 1-(ni & 1)*2;
    uv = vec3((meta >> 15) & 0x1f, (meta >> 10) & 0x1f, meta & 0x3ff);
    normal = (ni&4)==4 ? vec3(0,0,ns) : (ni&2)==2 ? vec3(0,ns,0) : vec3(ns,0,0);
    position = data.xyz;
  }
`,z=`#version 300 es
  precision highp float;

  uniform highp sampler2DArray blocks;
  uniform vec3 light1Pos;
  uniform vec3 light2Pos;
  uniform vec3 eyePos;

  in vec3 uv;
  in vec3 normal;
  in vec3 position;

  out vec4 outColor;

  void main(void) {
    vec4 textureColor = texture(blocks, uv);
    if (textureColor.a < 0.5) {
      discard;
    }
    float ambient = .2;

    vec3 lightDir = normalize(light1Pos - position);
    float diff = max(dot(normal, lightDir), 0.0)*.6;
    vec3 viewDir = normalize(eyePos - position);
    vec3 reflectDir = reflect(-lightDir, normal);
    float spec = pow(max(dot(viewDir, reflectDir), 0.0), 32.)*.2;
    float light1 = diff + spec;
    
    lightDir = normalize(light2Pos - position);
    diff = max(dot(normal, lightDir), 0.0)*.6;
    reflectDir = reflect(-lightDir, normal);
    spec = pow(max(dot(viewDir, reflectDir), 0.0), 32.)*.2;
    float light2 = diff + spec;

    outColor = vec4(vec3(ambient + light1 + light2),1) * textureColor;
    // outColor = vec4(normal * 0.5 + 0.5, 1);
  }
`,K=i("../imgs/minecraft-block-textures.avif");async function V(i){const n=l(i,O,z),a=f(i,n.attributes,{data:j(B)}),c=function(e,t,r,o,n){var i=e.createTexture();if(!i)throw new Error("Problem creating array texture");return e.bindTexture(e.TEXTURE_2D_ARRAY,i),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_WRAP_T,e.REPEAT),e.texStorage3D(e.TEXTURE_2D_ARRAY,1,e.RGBA8,t,r,o),e.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,t,r,o,e.RGBA,e.UNSIGNED_BYTE,n),e.generateMipmap(e.TEXTURE_2D_ARRAY),e.bindTexture(e.TEXTURE_2D_ARRAY,null),i}(i,16,16,32,await K);return setInterval(()=>{let e;for(;e=Math.floor(4096*Math.random()),!B[e];);let t=e>>0&15,r=e>>4&15,o=e>>8&15;for(;t=Math.min(16,Math.max(0,t+Math.floor(3*Math.random())-1)),r=Math.min(16,Math.max(0,r+Math.floor(3*Math.random())-1)),o=Math.min(16,Math.max(0,o+Math.floor(3*Math.random())-1)),B[t|r<<4|o<<8];);B[t|r<<4|o<<8]=B[e],B[e]=0,i.bindBuffer(i.ARRAY_BUFFER,a.attribs.data.buffer);var n=j(B);a.numElements=n.length>>2,i.bufferData(i.ARRAY_BUFFER,n,i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,null)},500),function(e,{eyePos:t,light1Pos:r,light2Pos:o}){i.useProgram(n.program),d(i,n.uniforms,{viewProjection:e,blocks:c,eyePos:t,light1Pos:r,light2Pos:o}),s(i,a),i.drawArrays(i.TRIANGLES,0,a.numElements)}}function W(){let e=new n(16);return n!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function H(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=t[4],c=t[5],l=t[6],f=t[7],u=t[8],s=t[9],m=t[10],E=t[11],d=t[12],h=t[13],g=t[14],A=t[15],v=r*c-o*a,T=r*l-n*a,p=r*f-i*a,w=o*l-n*c,R=o*f-i*c,_=n*f-i*l,y=u*h-s*d,P=u*g-m*d,b=u*A-E*d,U=s*g-m*h,x=s*A-E*h,M=m*A-E*g,t=v*M-T*x+p*U+w*b-R*P+_*y;return t?(e[0]=(c*M-l*x+f*U)*(t=1/t),e[1]=(n*x-o*M-i*U)*t,e[2]=(h*_-g*R+A*w)*t,e[3]=(m*R-s*_-E*w)*t,e[4]=(l*b-a*M-f*P)*t,e[5]=(r*M-n*b+i*P)*t,e[6]=(g*p-d*_-A*T)*t,e[7]=(u*_-m*p+E*T)*t,e[8]=(a*x-c*b+f*y)*t,e[9]=(o*b-r*x-i*y)*t,e[10]=(d*R-h*p+A*v)*t,e[11]=(s*p-u*R-E*v)*t,e[12]=(c*P-a*U-l*y)*t,e[13]=(r*U-o*P+n*y)*t,e[14]=(h*T-d*w-g*v)*t,e[15]=(u*w-s*T+m*v)*t,e):null}function Z(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],c=t[4],l=t[5],f=t[6],u=t[7],s=t[8],m=t[9],E=t[10],d=t[11],h=t[12],g=t[13],A=t[14],v=t[15],T=r[0],p=r[1],w=r[2],t=r[3];return e[0]=T*o+p*c+w*s+t*h,e[1]=T*n+p*l+w*m+t*g,e[2]=T*i+p*f+w*E+t*A,e[3]=T*a+p*u+w*d+t*v,T=r[4],p=r[5],w=r[6],t=r[7],e[4]=T*o+p*c+w*s+t*h,e[5]=T*n+p*l+w*m+t*g,e[6]=T*i+p*f+w*E+t*A,e[7]=T*a+p*u+w*d+t*v,T=r[8],p=r[9],w=r[10],t=r[11],e[8]=T*o+p*c+w*s+t*h,e[9]=T*n+p*l+w*m+t*g,e[10]=T*i+p*f+w*E+t*A,e[11]=T*a+p*u+w*d+t*v,T=r[12],p=r[13],w=r[14],t=r[15],e[12]=T*o+p*c+w*s+t*h,e[13]=T*n+p*l+w*m+t*g,e[14]=T*i+p*f+w*E+t*A,e[15]=T*a+p*u+w*d+t*v,e}function $(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],c=o+o,l=n+n,f=i+i,u=o*c,s=o*l,t=o*f,o=n*l,n=n*f,i=i*f,c=a*c,l=a*l,f=a*f;return e[0]=1-(o+i),e[1]=s+f,e[2]=t-l,e[3]=0,e[4]=s-f,e[5]=1-(u+i),e[6]=n+c,e[7]=0,e[8]=t+l,e[9]=n-c,e[10]=1-(u+o),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function q(e,t,r,o,n){t=1/Math.tan(t/2);return e[0]=t/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(e[10]=(n+o)*(t=1/(o-n)),e[14]=2*n*o*t):(e[10]=-1,e[14]=-2*o),e}function Q(){let e=new n(4);return n!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function J(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function ee(e,t,r){r*=.5;var o=t[0],n=t[1],i=t[2],a=t[3],t=Math.sin(r),r=Math.cos(r);return e[0]=o*r+a*t,e[1]=n*r+i*t,e[2]=i*r-n*t,e[3]=a*r-o*t,e}function te(e,t,r){r*=.5;var o=t[0],n=t[1],i=t[2],a=t[3],t=Math.sin(r),r=Math.cos(r);return e[0]=o*r-i*t,e[1]=n*r+a*t,e[2]=i*r+o*t,e[3]=a*r-n*t,e}!function(){let e=new n(4);n!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}();r(),e(1,0,0),e(0,1,0),Q(),Q(),function(){let e=new n(9);n!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}();const re=document.createElement("canvas");document.body.appendChild(re);let oe,ne;g=re.getContext("webgl2",{antialias:!0,preserveDrawingBuffer:!0});if(!g)throw new Error("Problem getting webgl2 context");const ie=g,ae=W(),ce=W();ie.clearColor(0,0,0,1),ie.enable(ie.DEPTH_TEST),ie.enable(ie.CULL_FACE),ie.cullFace(ie.BACK),async function(e){const[r,o]=await Promise.all([t(e,`../imgs/${["blue","orange","cyan"][Math.floor(3*Math.random())]}-sky.avif`),V(e)]);return function(e,t){o(e,t),r(e,t)}}(ie).then(c=>{function e(){oe=window.innerWidth,ne=window.innerHeight,re.setAttribute("width",oe),re.setAttribute("height",ne),ie.viewport(0,0,oe,ne)}(window.onresize=e)();const l={KeyQ:0,KeyE:0,KeyW:0,KeyA:0,KeyS:0,KeyD:0,joyX:0,joyY:0,joyZ:0,get z(){return l.KeyW-l.KeyS+l.joyY},get x(){return l.KeyA-l.KeyD-l.joyX},get y(){return l.KeyQ-l.KeyE-l.joyZ},get speed(){return l.ControlLeft?.008:.004},get fov(){return l.ControlLeft?75:60},rotateY:0,rotateX:0};function a(e,t){for(l.rotateY-=.4*e;l.rotateY<0;)l.rotateY+=360;for(;360<=l.rotateY;)l.rotateY-=360;l.rotateX=Math.max(-90,Math.min(90,l.rotateX-.5*t))}function f(e,t){l.joyX=Math.min(1,Math.max(-1,(e-100)/75)),l.joyY=Math.min(1,Math.max(-1,(t-100)/75))}function u(e){l.joyZ=Math.min(1,Math.max(-1,(e-100)/75))}window.onkeydown=e=>{"number"==typeof l[e.code]&&(e.preventDefault(),e.repeat||(l[e.code]=1))},window.onkeyup=e=>{"number"==typeof l[e.code]&&(e.preventDefault(),l[e.code]=0)},window.onmousemove=e=>{document.pointerLockElement===document.body&&(e.preventDefault(),a(e.movementX,e.movementY))},document.body.onclick=e=>{document.body.requestPointerLock(),document.body.requestFullscreen()};const s={};let m=!1;window.addEventListener("touchstart",e=>{m||(m=!0,document.getElementById("arrows").style.display="block",document.getElementById("fly").style.display="block"),e.preventDefault();for(var{identifier:t,clientX:r,clientY:o}of e.changedTouches){var n=window.innerHeight-o,i=r;if(25<=n&&n<=175){if(25<=i&&i<=175)return s[t]={mode:"joy"},f(i,n);i=window.innerWidth-r;if(25<=i&&i<=75)return s[t]={mode:"fly"},u(n)}s[t]={clientX:r,clientY:o,mode:"drag"}}}),window.addEventListener("touchend",e=>{e.preventDefault();for(var{identifier:t}of e.changedTouches){var r=s[t]["mode"];delete s[t],"joy"===r?(l.joyX=0,l.joyY=0):"fly"===r&&(l.joyZ=0)}}),window.addEventListener("touchmove",e=>{e.preventDefault();for(var{identifier:t,clientX:r,clientY:o}of e.changedTouches){const i=s[t];var n;"drag"===i.mode?(n=r-i.clientX,t=o-i.clientY,i.clientX=r,i.clientY=o,a(n,t)):"joy"===i.mode?f(r,window.innerHeight-o):"fly"===i.mode&&u(window.innerHeight-o)}});let E=Date.now();const d=r();v(d,10,4.5,8);const h=r(),g=Q();window.requestAnimationFrame(function e(){const t=Date.now();const r=E-t;E=t;const o=r*l.speed;const n=l.rotateY*Math.PI/180;const i=l.rotateX*Math.PI/180;const a=A(v(h,l.x,l.y,l.z));1<a&&T(h,h,1/a);p(d,d,w(h,h,[0,0,0],n),o);J(g);te(g,g,n);ee(g,g,i);$(ce,g,d);q(ae,l.fov*Math.PI/180,oe/ne,.1,1e3);Z(ce,ae,H(ce,ce));ie.clear(ie.COLOR_BUFFER_BIT|ie.DEPTH_BUFFER_BIT);c(ce,{light1Pos:d,light2Pos:[8,20,8],eyePos:d});window.requestAnimationFrame(e)})});